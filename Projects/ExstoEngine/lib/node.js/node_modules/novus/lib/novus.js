(function (exports) {
    var io = require('socket.io'),
    	config = require('./config'),
        nv = exports;
    
    nv.version = '0.0.1';
    
    nv.app = {};

    nv.listen = function(app) {
        nv.app = app;
        
        var server = io.listen(app);
        
        server.sockets.on('connection', function(socket) {
            nv.UserManager.bind(socket);
            nv.RoomManager.bind(socket);
            
            socket.on('disconnect', function (data) {
        		socket.get('user', function (err, user) {
        			nv.UserManager.disconnect(user);
            		nv.RoomManager.disconnect(user);
        		});
            });
        });
    };
    
    nv.configure = config.configure,
    
    nv.UserManager = require('./usermanager');
    
    nv.RoomManager = require('./roommanager');
})(exports);