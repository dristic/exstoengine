(function(){var b={Inline:"Inline",Ajax:"Ajax"};var a={bind:function(d,c){return function(){return d.apply(c,arguments)}},Base:{},Display:{},Util:{},World:{},includeTypes:{Inline:"Inline",Ajax:"Ajax"},includeType:b.Inline,include:function(e){if(typeof e=="object"){for(var d=0;d<e.length;d++){a.include(e[d])}}else{if(this.includeType==this.includeTypes.Ajax){toLoad++;if(isLast==true){last=true}var c;if(window.XMLHttpRequest){c=new XMLHttpRequest()}else{c=new ActiveXObject("Microsoft.XMLHTTP")}c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){var g=document.getElementsByTagName("HEAD").item(0);var f=document.createElement("script");f.language="javascript";f.type="text/javascript";f.defer=true;f.text=c.responseText;g.appendChild(f)}};c.open("GET",e);c.send()}else{if(this.includeType==this.includeTypes.Inline){if(document.getElementById(e)==null){document.write('<script type="text/javascript" src="'+e+'"><\/script>')}}}}}};a.include("js/exstoengine/util/Stats.js");a.include(["js/exstoengine/base/Class.js","js/exstoengine/base/Component.js","js/exstoengine/base/Vector.js","js/exstoengine/base/Point.js","js/exstoengine/base/Rectangle.js","js/exstoengine/util/Debug.js","js/exstoengine/util/Key.js","js/exstoengine/util/Input.js","js/exstoengine/util/Logger.js","js/exstoengine/world/TileMap.js","js/exstoengine/display/Camera.js","js/exstoengine/display/ImageRepository.js","js/exstoengine/display/SpriteMap.js","js/exstoengine/display/Sprite.js","js/exstoengine/display/AnimatedSprite.js","js/exstoengine/display/Emitter.js","js/exstoengine/display/Particle.js","js/exstoengine/display/Renderer.js","js/exstoengine/world/World.js","js/exstoengine/world/CollisionMap.js","js/exstoengine/base/Engine.js"]);window.ExstoEngine=a}());(function(){window.ExstoEngine.Base.Class=function(f,e){var d={};if(f!=null){d=c(f.prototype)}function g(){}if(typeof e.constructor=="function"&&e.constructor!=Object){g=e.constructor}else{if(typeof d.constructor=="function"){g=d.constructor}}if(f!=null){g.prototype=c(f.prototype);a(g.prototype,e);g.prototype._super=function(i,h){d[i].apply(this,h)}}else{g.prototype=e}g.constructor=g;return g};function c(d){function e(){}e.prototype=d;return new e()}function a(d,e){b(e,function(f,g){d[f]=g})}function b(d,f){for(var e in d){if(Object.prototype.propertyIsEnumerable.call(d,e)){f(e,d[e])}}}})();(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(){},update:function(b){},name:"Component"});window.ExstoEngine.Base.Component=a}());(function(){function b(d,c){return function(){return d.apply(c,arguments)}}var a=new ExstoEngine.Base.Class(null,{constructor:function(f,c,e){if(document.createElement("canvas").getContext){this.frameRate=e||50;this.width=f;this.height=c;this.currentWorld=null;this.lastTime=(new Date()).getTime();this.components=[];this.debug=false;var d=null;this.logger=new ExstoEngine.Util.Logger();this.input=new ExstoEngine.Util.Input();this.imageRepository=new ExstoEngine.Display.ImageRepository();this.camera=new ExstoEngine.Display.Camera();d=setInterval(b(this.update,this),(1/e)*1000)}else{this.logger=new ExstoEngine.Util.Logger();this.logger.log("Your browser does not support canvas!")}},enableDebugging:function(){this.debug=true;this.loadComponent(new ExstoEngine.Util.Debug());this.getComponent("Debug").renderer=this.renderer;this.getComponent("Debug").logger=this.logger},setupCanvas:function(d,c){this.renderer=new ExstoEngine.Display.Renderer(this.width,this.height,d,c);this.camera.canvas=c||this.renderer.canvas},update:function(){var e=(new Date()).getTime();var d=e-this.lastTime;d/=1000;this.lastTime=e;var c=this.components.length;while(c--){this.components[c].update(d)}if(this.currentWorld!=null){this.currentWorld.update(d)}this.camera.update(d);if(this.renderer!=null){this.renderer.update(d,this.camera.x,this.camera.y)}this.onUpdate();this.input.update(d)},onUpdate:function(){},openWorld:function(c){if(this.currentWorld!=null){this.currentWorld.destroy()}this.currentWorld=new c(this.renderer)},loadComponent:function(c){if(c instanceof ExstoEngine.Base.Component==false){this.logger.log("Component must be an instance of ExstoEngine.Base.Component!")}else{this.components.push(c)}},getComponent:function(c){var d=this.components.length;while(d--){if(this.components[d].name==c){return this.components[d]}}}});window.ExstoEngine.Base.Engine=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(b,c){this.x=b;this.y=c},add:function(b){this.x+=b.x;this.y+=b.y},subtract:function(b){this.x-=b.x;this.y-=b.y}});window.ExstoEngine.Base.Point=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(c,e,d,b){this.x=c;this.y=e;this.width=d;this.height=b},containsPoint:function(b,c){if(b instanceof ExstoEngine.Base.Point){if(b.x>this.x&&b.x<this.x+this.width&&b.y>this.y&&b.y<this.y+this.height){return true}else{return false}}else{if(b>this.x&&b<this.x+this.width&&c>this.y&&c<this.y+this.height){return true}else{return false}}},shift:function(b,c){this.x-=b;this.y-=c;return this}});window.ExstoEngine.Base.Rectangle=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(b,c){this.x=b||0;this.y=c||0},add:function(b){this.x+=b.x;this.y+=b.y;return this},addScaled:function(b,c){this.x+=(b.x*c);this.y+=(b.y*c);return this},subtract:function(b){this.x-=b.x;this.y-=b.y},scale:function(b){this.x*=b;this.y*=b;return this},distance:function(b){return Math.sqrt(Math.pow((this.x-b.x),2)+Math.pow((this.y-b.y),2))},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},clone:function(){return new ExstoEngine.Base.Vector(this.x,this.y)},rotate:function(c){var e=Math.cos(c),d=Math.sin(c),b=this.x,f=this.y;this.x=b*e-f*d;this.y=b*d+f*e;return this}});window.ExstoEngine.Base.Vector=a}());(function(){var c=new ExstoEngine.Base.Class(ExstoEngine.Display.Sprite,{constructor:function(d,i,e,h,g,f){this.timer=(1/g);this.frameRate=g;this.animations={};this.curAnimation=[];this.curFrame=0;this.playing=true;this._super("constructor",[d,i,f]);this.renderingRect={x:0,y:0,width:e,height:h};this.width=e;this.height=h},createAnimation:function(d,e){this.animations[d]=e},play:function(d,e){if(e==null||e==false){if(this.curAnimation==this.animations[d]&&this.playing==true){return}}this.curAnimation=this.animations[d];this.curFrame=0;this.playing=true},stop:function(){this.playing=false},update:function(e){if(this.playing==true){if(this.frameRate>0){this.timer-=e;if(this.timer<0){this.timer+=(1/this.frameRate);if(this.img.width>0&&this.img.height>0){var d=b(this.curAnimation,this.curFrame)+1;if(d>this.curAnimation.length-1){d=0}this.curFrame=this.curAnimation[d];this.goToFrame(this.curFrame)}}}}this._super("update",[e])},render:function(e,f,d){e.drawImage(this.img,this.renderingRect.x,this.renderingRect.y,this.renderingRect.width,this.renderingRect.height,this.position.x-(f*this.scrollFactorX),this.position.y-(d*this.scrollFactorY),this.renderingRect.width,this.renderingRect.height)},goToFrame:function(g){var f=this.img.width/this.renderingRect.width;var e=g%f;var d=Math.floor(g/f);this.renderingRect.x=e*this.renderingRect.width;this.renderingRect.y=d*this.renderingRect.height},goToNextFrame:function(){this.renderingRect.x+=this.renderingRect.width;if((this.renderingRect.x+this.renderingRect.width)>this.img.width){this.renderingRect.x=0;this.renderingRect.y+=this.renderingRect.height;if((this.renderingRect.y+this.renderingRect.height)>this.img.height){this.renderingRect.y=0}}},numFrames:function(){var d=this.img.width/this.renderingRect.width;var e=this.img.height/this.renderingRect.height;return d*e}});function a(f,e){var d=f.length;while(d--){if(f[d]==e){return true}}return false}function b(f,e){var d=f.length;while(d--){if(f[d]==e){return d}}return d}window.ExstoEngine.Display.AnimatedSprite=c}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(){this.x=0;this.y=0;this.following=null;this.canvas=null},update:function(b){if(this.following!=null&&this.canvas!=null){this.x=this.following.x+(this.following.width>>1)-(this.canvas.width>>1);this.y=this.following.y+(this.following.height>>1)-(this.canvas.height>>1)}},follow:function(b){this.following=b}});window.ExstoEngine.Display.Camera=a}());(function(){function b(c,e){for(var d in e){c[d]=e[d]}}var a=new ExstoEngine.Base.Class(null,{constructor:function(c){var d={position:new ExstoEngine.Base.Vector(150,150),velocity:new ExstoEngine.Base.Vector(0,-3),xVariance:20,yVariance:5,spawnSpeed:4,generations:100000,maxParticles:500,size:20,sizeVariance:5,life:30,lifeVariance:10,direction:0,directionVariance:15,color:"#cef",opacity:1,scrollFactorX:1,scrollFactorY:1,onDraw:function(e){var f=-this.age*3;e.size*=0.98;e.color="rgb(255, "+(f+255)+", 68)";e.alpha=0.5-(e.age/e.life*0.4)}};b(d,c);this.options=d;this.particles=[]},update:function(e){if(this.options.generations!=-1&&this.age<=this.options.generations){if(this.particles.length==0&&this.options.generations<=this.age){this.active=false}this.age++}for(var d in this.particles){var f=this.particles[d];if(f.active===false){this.particles.splice(d,1)}else{f.update(e)}}for(var c=0;c<this.options.spawnSpeed;c++){if(this.particles.length>=this.options.maxParticles||this.options.generations<=this.age){return}this.particles.push(new ExstoEngine.Display.Particle(this.options))}},render:function(e,f,d){for(var c in this.particles){this.particles[c].render(e,f,d)}}});window.ExstoEngine.Display.Emitter=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(){this.img=[];this.ready=true;this.imagesLoaded=0;this.imagesToLoad=0},loadImage:function(c,b){this.img[c]=new Image();this.ready=false;this.imagesToLoad++;this.img[c].onload=function(){a.imagesLoaded++;if(a.imagesLoaded==a.imagesToLoad){a.ready=true}};this.img[c].src="";this.img[c].src=b}});window.ExstoEngine.Display.ImageRepository=a}());(function(){function b(d){return(Math.random()*d<<1)-d}function c(d,f){for(var e in f){d[e]=f[e]}}var a=new ExstoEngine.Base.Class(null,{constructor:function(d){var e={position:new ExstoEngine.Base.Vector(0,0),velocity:new ExstoEngine.Base.Vector(0,0),xVariance:0,yVariance:0,direction:new ExstoEngine.Base.Vector(0,0),directionVariance:0,age:0,life:0,lifeVariance:0,size:0,sizeVariance:0,active:true,alpha:1,color:"#cef"};c(e,d);e.direction=d.direction+b(d.directionVariance);e.position=d.position.clone().add(e.position);e.velocity=d.velocity.clone().rotate(e.direction*Math.PI/180);e.life=d.life+b(d.lifeVariance);e.size=d.size+b(d.sizeVariance);c(this,e)},update:function(d){if(this.age>=this.life){this.active=false}this.position.add(this.velocity);this.alpha-=0.1;this.age++},render:function(f,g,d){if(typeof this.onDraw==="function"){this.onDraw(this)}f.save();f.fillStyle=this.color;try{f.globalAlpha=this.alpha}catch(h){}f.translate(this.position.x-(g*this.scrollFactorX),this.position.y-(d*this.scrollFactorY));f.beginPath();f.arc(0,0,this.size/2,0,Math.PI/180,true);f.closePath();f.fill();f.restore()}});window.ExstoEngine.Display.Particle=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(){},update:function(b){},render:function(c,d,b){}});window.ExstoEngine.Display.Renderable=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(d,b,e,c){this.canvas=c||document.createElement("canvas");this.canvas.width=d;this.canvas.height=b;this.canvas.style.backgroundColor=e;this.context=this.canvas.getContext("2d");this.renderables=[];if(c==null){document.body.appendChild(this.canvas)}},update:function(e,d,c){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var b=this.renderables.length;while(b--){this.renderables[b].render(this.context,d,c)}}});window.ExstoEngine.Display.Renderer=a}());(function(){window.ExstoEngine.Display.Sprite=new window.ExstoEngine.Base.Class(null,{constructor:function(a,c,b){this.x=a||0;this.y=c||0;this.position=new ExstoEngine.Base.Vector(a,c);this.velocity=new ExstoEngine.Base.Vector(0,0);this.img=b||new Image();this.visible=true;this.width=this.img.width;this.height=this.img.height;this.halfWidth=function(){return this.img.width>>1};this.halfHeight=function(){return this.img.height>>1};this.rotation=0;this.rotationEnabled=false;this.rotationCanvas=document.createElement("canvas");this.scrollFactorX=1;this.scrollFactorY=1;this.rotationCanvas.width=this.img.width;this.rotationCanvas.height=this.img.height},update:function(a){if(this.width==0){this.width=this.img.width;this.height=this.img.height}if(typeof this.onUpdate==="function"){this.onUpdate(a)}},render:function(c,d,b){if(this.visible==true){if(this.rotationEnabled==false){c.drawImage(this.img,this.x-(d*this.scrollFactorX),this.y-(b*this.scrollFactorY))}else{var a=this.rotationCanvas.getContext("2d");this.rotationCanvas.width=this.img.width||1;this.rotationCanvas.height=this.img.height||1;a.save();a.translate(this.halfWidth(),this.halfHeight());a.rotate(this.rotation);a.translate(-this.halfWidth(),-this.halfHeight());a.drawImage(this.img,0,0);a.restore();c.drawImage(this.rotationCanvas,this.x-(d*this.scrollFactorX),this.y-(b*this.scrollFactorY))}}},handleCollision:function(a){if(a.y==true){this.velocity.y=0;this.position.y=a.position.y}if(a.x==true){this.velocity.x=0;this.position.x=a.position.x}},getBounds:function(){return new ExstoEngine.Base.Rectangle(this.x,this.x,this.width,this.height)}})})();(function(){var a=new ExstoEngine.Base.Class(ExstoEngine.World.TileMap,{constructor:function(e,c,d,b){this.img=b;this.x=0;this.y=0;this.scrollFactorX=this.scrollFactorY=1;this._super("constructor",[e,c,d])},update:function(b){},render:function(d,e,c){for(var i=0;i<this.map.length;i++){for(var b=0;b<this.map[i].length;b++){var f=this.map[i][b],h=0,g=0;if(f!=0){while(--f){h+=this.tileWidth;if(h>=this.img.width){g+=this.tileHeight;h=0}}d.drawImage(this.img,h,g,this.tileWidth,this.tileHeight,this.x-(e*this.scrollFactorX)+(b*this.tileWidth),this.y-(c*this.scrollFactorY)+(i*this.tileHeight),this.tileWidth,this.tileHeight)}}}}});window.ExstoEngine.Display.SpriteMap=a}());(function(){function a(e){var c=0;var d=e.length;while(d--){c+=e[d]}c=c/e.length;return c}var b=new ExstoEngine.Base.Class(ExstoEngine.Base.Component,{constructor:function(){this.domElement=document.createElement("div");this.domElement.style.backgroundColor="#222526";this.domElement.style.opacity="0.9";this.domElement.style.border="1px solid #ffbb6e";this.domElement.style.color="#f28d00";this.domElement.style.fontSize="10pt";this.domElement.style.position="fixed";this.domElement.style.bottom="5px";this.domElement.style.right="5px";this.domElement.style.padding="5px";this.logged=[];this.name="Debug";this.renderer=null;this.logger=null;this.loggerElement=document.createElement("div");this.loggerElement.style.backgroundColor="#111111";this.loggerElement.style.padding="5px";this.loggerElement.style.color="#FFFFFF";this.loggerElement.style.maxHeight="150px";this.loggerElement.style.maxWidth="200px";this.loggerElement.style.overflow="auto";this.writeLog=document.createElement("input");this.writeLog.type="checkbox";this.writeLog.name="writeLog";this.writeLog.value="checked";this.writeLog.id="writeLog";this.loggerElement.appendChild(this.writeLog);document.body.appendChild(this.domElement)},update:function(d){this._super("update",[d]);this.logged.push(d);if(this.logged.length>20){this.logged.shift()}var c=a(this.logged);var e=Math.floor(1/c);this.domElement.innerHTML="<b>"+e+" fps </b>";this.domElement.innerHTML+=" | "+Math.floor(c*1000)+" ms";if(this.renderer!=null){this.domElement.innerHTML+=" | "+this.renderer.renderables.length+" sprites"}if(this.logger!=null){this.domElement.innerHTML+=" | Console ";this.domElement.appendChild(this.writeLog);if(this.writeLog.checked==true){this.loggerElement.innerHTML=this.logger.textLog;this.domElement.appendChild(this.loggerElement);this.loggerElement.scrollTop=this.loggerElement.scrollHeight}}}});window.ExstoEngine.Util.Debug=b}());(function(){var a=ExstoEngine.Base.Class(null,{constructor:function(){this.keys=[];this.pressed=[];this.pressedTimer=1;this.mouseX=0;this.mouseY=0;this.mouseDown=false;this.mouseUp=false;document.addEventListener("keydown",ExstoEngine.bind(this.onKeyDown,this));document.addEventListener("keyup",ExstoEngine.bind(this.onKeyUp,this));document.addEventListener("mousedown",ExstoEngine.bind(this.onMouseDown,this));document.addEventListener("mouseup",ExstoEngine.bind(this.onMouseUp,this));document.addEventListener("mousemove",ExstoEngine.bind(this.onMouseMove,this))},update:function(c){var b=this.pressed.length;while(b--){if(this.pressed[b]>0){this.pressed[b]--}}this.mouseDown=false;this.mouseUp=false},onMouseDown:function(b){this.mouseDown=true},onMouseUp:function(b){this.mouseUp=true},onMouseMove:function(b){if(!b){b=window.event}if(b.pageX||b.pageY){this.mouseX=b.pageX;this.mouseY=b.pageY}else{if(b.clientX||b.clientY){this.mouseX=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;this.mouseY=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}},onKeyDown:function(b){if(this.keys[b.keyCode]==false||!this.keys[b.keyCode]){this.keys[b.keyCode]=true;this.pressed[b.keyCode]=this.pressedTimer}},onKeyUp:function(b){this.keys[b.keyCode]=false},isKeyDown:function(b){return this.keys[b]},isKeyPressed:function(b){if(this.pressed[b]>0){return true}else{return false}}});window.ExstoEngine.Util.Input=a}());(function(){var a={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,PauseBreak:19,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Keyb0:48,Keyb1:49,Keyb2:50,Keyb3:51,Keyb4:52,Keyb5:53,Keyb6:54,Keyb7:55,Keyb8:56,Keyb9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadStar:106,NumpadPlus:107,NumpadMinus:109,NumpadPeriod:110,NumpadSlash:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F11:122,F12:123,F13:124,F14:125,F15:126,NumLck:144,ScrLck:145,SemiColon:186,Equal:187,Comma:188,Minus:189,Period:190,Question:191,BackQuote:192,LeftBrace:219,Pipe:220,RightBrace:221,SingleQuote:222};window.ExstoEngine.Util.Key=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(){this.textLog="--Logger Enabled \n"},log:function(b){this.textLog+="- "+b+"<br />"}});window.ExstoEngine.Util.Logger=a}());var Stats=function(){function N(g,a,i){var b,e,h;for(e=0;e<30;e++){for(b=0;b<73;b++){h=(b+e*74)*4;g[h]=g[h+4];g[h+1]=g[h+5];g[h+2]=g[h+6]}}for(e=0;e<30;e++){h=(73+e*74)*4;if(e<a){g[h]=ak[i].bg.r;g[h+1]=ak[i].bg.g;g[h+2]=ak[i].bg.b}else{g[h]=ak[i].fg.r;g[h+1]=ak[i].fg.g;g[h+2]=ak[i].fg.b}}}var P=0,K=2,aj,n=0,ad=(new Date).getTime(),f=ad,d=ad,ab=0,Z=1000,X=0,ac,ai,al,aa,W,Y=0,U=1000,S=0,ah,ag,V,Q,T=0,O=1000,M=0,af,ae,R,u,ak={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};aj=document.createElement("div");aj.style.cursor="pointer";aj.style.width="80px";aj.style.opacity="0.9";aj.style.zIndex="10001";aj.addEventListener("click",function(){P++;P==K&&(P=0);ac.style.display="none";ah.style.display="none";af.style.display="none";switch(P){case 0:ac.style.display="block";break;case 1:ah.style.display="block";break;case 2:af.style.display="block"}},false);ac=document.createElement("div");ac.style.backgroundColor="rgb("+Math.floor(ak.fps.bg.r/2)+","+Math.floor(ak.fps.bg.g/2)+","+Math.floor(ak.fps.bg.b/2)+")";ac.style.padding="2px 0px 3px 0px";aj.appendChild(ac);ai=document.createElement("div");ai.style.fontFamily="Helvetica, Arial, sans-serif";ai.style.textAlign="left";ai.style.fontSize="9px";ai.style.color="rgb("+ak.fps.fg.r+","+ak.fps.fg.g+","+ak.fps.fg.b+")";ai.style.margin="0px 0px 1px 3px";ai.innerHTML='<span style="font-weight:bold">FPS</span>';ac.appendChild(ai);al=document.createElement("canvas");al.width=74;al.height=30;al.style.display="block";al.style.marginLeft="3px";ac.appendChild(al);aa=al.getContext("2d");aa.fillStyle="rgb("+ak.fps.bg.r+","+ak.fps.bg.g+","+ak.fps.bg.b+")";aa.fillRect(0,0,al.width,al.height);W=aa.getImageData(0,0,al.width,al.height);ah=document.createElement("div");ah.style.backgroundColor="rgb("+Math.floor(ak.ms.bg.r/2)+","+Math.floor(ak.ms.bg.g/2)+","+Math.floor(ak.ms.bg.b/2)+")";ah.style.padding="2px 0px 3px 0px";ah.style.display="none";aj.appendChild(ah);ag=document.createElement("div");ag.style.fontFamily="Helvetica, Arial, sans-serif";ag.style.textAlign="left";ag.style.fontSize="9px";ag.style.color="rgb("+ak.ms.fg.r+","+ak.ms.fg.g+","+ak.ms.fg.b+")";ag.style.margin="0px 0px 1px 3px";ag.innerHTML='<span style="font-weight:bold">MS</span>';ah.appendChild(ag);al=document.createElement("canvas");al.width=74;al.height=30;al.style.display="block";al.style.marginLeft="3px";ah.appendChild(al);V=al.getContext("2d");V.fillStyle="rgb("+ak.ms.bg.r+","+ak.ms.bg.g+","+ak.ms.bg.b+")";V.fillRect(0,0,al.width,al.height);Q=V.getImageData(0,0,al.width,al.height);try{if(performance&&performance.memory&&performance.memory.totalJSHeapSize){K=3}}catch(c){}af=document.createElement("div");af.style.backgroundColor="rgb("+Math.floor(ak.mem.bg.r/2)+","+Math.floor(ak.mem.bg.g/2)+","+Math.floor(ak.mem.bg.b/2)+")";af.style.padding="2px 0px 3px 0px";af.style.display="none";aj.appendChild(af);ae=document.createElement("div");ae.style.fontFamily="Helvetica, Arial, sans-serif";ae.style.textAlign="left";ae.style.fontSize="9px";ae.style.color="rgb("+ak.mem.fg.r+","+ak.mem.fg.g+","+ak.mem.fg.b+")";ae.style.margin="0px 0px 1px 3px";ae.innerHTML='<span style="font-weight:bold">MEM</span>';af.appendChild(ae);al=document.createElement("canvas");al.width=74;al.height=30;al.style.display="block";al.style.marginLeft="3px";af.appendChild(al);R=al.getContext("2d");R.fillStyle="#301010";R.fillRect(0,0,al.width,al.height);u=R.getImageData(0,0,al.width,al.height);return{domElement:aj,update:function(){n++;ad=(new Date).getTime();Y=ad-f;U=Math.min(U,Y);S=Math.max(S,Y);N(Q.data,Math.min(30,30-Y/200*30),"ms");ag.innerHTML='<span style="font-weight:bold">'+Y+" MS</span> ("+U+"-"+S+")";V.putImageData(Q,0,0);f=ad;if(ad>d+1000){ab=Math.round(n*1000/(ad-d));Z=Math.min(Z,ab);X=Math.max(X,ab);N(W.data,Math.min(30,30-ab/100*30),"fps");ai.innerHTML='<span style="font-weight:bold">'+ab+" FPS</span> ("+Z+"-"+X+")";aa.putImageData(W,0,0);if(K==3){T=performance.memory.usedJSHeapSize*9.54e-7;O=Math.min(O,T);M=Math.max(M,T);N(u.data,Math.min(30,30-T/2),"mem");ae.innerHTML='<span style="font-weight:bold">'+Math.round(T)+" MEM</span> ("+Math.round(O)+"-"+Math.round(M)+")";R.putImageData(u,0,0)}d=ad;n=0}}}};(function(){var a=new ExstoEngine.Base.Class(ExstoEngine.World.TileMap,{constructor:function(d,b,c){this._super("constructor",[d,b,c])},collide:function(c,k,h,i,f,b,n){var m={x:false,y:false,position:new ExstoEngine.Base.Vector(),tileType:new ExstoEngine.Base.Point()};var e=Math.ceil(Math.abs(i*c)/this.tileWidth);var d=Math.ceil(Math.abs(f*c)/this.tileHeight);var g=Math.max(e,d);if(g>1){while(g){var l=i/g;var j=f/g;this.checkArea(c,m,k,h,l,j,b,n);if(m.x==true){break}else{if(m.y==true){break}}g--}}else{this.checkArea(c,m,k,h,i,f,b,n)}return m},checkArea:function(m,f,k,i,p,o,q,n){var c=k+(p*m);var b=i+(o*m);if(p!=0){var h,l,d,r;h=c;if(p>0){h+=q}l=Math.floor(h/this.tileWidth);d=Math.floor(i/this.tileHeight);r=Math.ceil((i+n)/this.tileHeight);for(var j=d;j<r;j++){if(this.map[j]){var t=this.map[j][l];if(t!=0&&t!=null){f.x=true;f.position.x=(l*this.tileWidth);if(p<0){f.position.x+=this.tileWidth}else{f.position.x-=q}f.tileType.x=t;break}}}}if(o!=0){var g,j,e,s;g=b;if(o>0){g+=n}j=Math.floor(g/this.tileHeight);e=Math.floor(k/this.tileWidth);s=Math.ceil((k+q)/this.tileWidth);for(var l=e;l<s;l++){if(this.map[j]){var t=this.map[j][l];if(t!=0&&t!=null){f.y=true;f.position.y=(j*this.tileHeight);if(o<0){f.position.y+=this.tileHeight}else{f.position.y-=n}f.tileType.y=t;break}}}}}});window.ExstoEngine.World.CollisionMap=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(d,b,c){this.tileWidth=d;this.tileHeight=b;this.map=c;this.width=this.map[0].length*this.tileWidth;this.height=this.map.length*this.tileHeight},getTile:function(b,c){b=Math.floor(b/this.tileWidth);c=Math.floor(c/this.tileHeight);return this.map[c][b]},setTile:function(b,d,c){b=Math.floor(b/this.tileWidth);d=Math.floor(d/this.tileHeight);this.map[d][b]=c}});window.ExstoEngine.World.TileMap=a}());(function(){var a=new ExstoEngine.Base.Class(null,{constructor:function(b){this.renderer=b;this.objects=[]},update:function(c){var b=this.objects.length;while(b--){this.objects[b].update(c)}},addObject:function(b){this.objects.push(b);this.renderer.renderables.push(b)},destroy:function(){}});window.ExstoEngine.World.World=a}());